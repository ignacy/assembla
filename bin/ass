#!/usr/bin/env ruby

$:.unshift File.join(File.dirname(__FILE__), *%w[.. lib])

require 'assembla'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: ass [options]"

  opts.on("-v", "--version", "Get version") do |v|
    options[:verbose] = v
    puts "Assembla version 0.8.0"
  end

  opts.on("-a", "--all", "Print your active and new tickets") do |a|
    options[:all] = a
    @assem = AssEmBlr.new
    @assem.print(@assem.find_my_active_tickets)
  end

  opts.on("-s", "--status STATUS", "Find ticket with given status") do |status|
    options[:status] = status
    @assem = AssEmBlr.new
    with_id = @assem.find({:status => options[:status]})
    @assem.print(with_id)
  end

  opts.on( '-h', '--help', 'Display this screen' ) do
    puts opts
    exit
  end

  opts.on( '-t', '--to TO', 'Assigned to TO, example: ass -t "John Doe" ') do |to|
    @assem = AssEmBlr.new
    @assem.print(@assem.find({:assigned_to => to}))
  end

  opts.on("--toandstatus DATA", 'Assigned to TO and with STATUS, call like this: ass --toandstatus "Name Surname"__New ') do |data|
    to, status = data.split(/__/)
    puts "to #{to} status #{status}"
    @assem = AssEmBlr.new
    @assem.print(@assem.find({:assigned_to => to, :status => status}))
  end

end.parse!

